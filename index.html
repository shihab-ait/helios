<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/img/helios.png" type="image/png">
    <title>Interactive Helios Architecture</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style id="dynamic-styles">
        /* Base and Static Custom styles */
        .block {
            transition: all 0.2s ease-in-out;
            cursor: default;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            display: flex; 
            align-items: center;
            justify-content: center;
            font-weight: 600;
            text-align: center;
            padding: 0.5rem; 
        }
        /* Hover effect only for interactive blocks */
        .block:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }
        .highlight {
            border: 3px solid;
            z-index: 10;
        }

        /* Container for the diagram */
        .diagram-container {
            position: relative;
            padding: 2rem 0 1rem;
            max-width: 1200px;
            margin: auto;
        }

        /* Styles for the boundary titles */
        .boundary-title {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translate(-50%, -50%); 
            z-index: 20; 
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            text-align: center;
            white-space: nowrap; 
        }

        /* Specific Title Styles */
        #helios { width: 50px; padding: 0; }
        #control-plane-title { background-color: #f3e8ff; border: 1px solid #c084fc; color: #7e22ce; }
        #core-services-title { background-color: #dcfce7; border: 1px solid #4ade80; color: #16a34a; }
        #business-solutions-title { background-color: #fef3c7; border: 1px solid #fbbf24; color: #b45309; }

        /* Ensure containers have top padding for the title displacement */
        #control-plane-container, #core-services-container, #business-solutions-container {
            padding: 2rem 1rem 1rem;
        }

        /* Custom styling for the dropdown selection display */
        #client-product-dropdown {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            /* SVG icon for the dropdown arrow */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='currentColor'%3E%3Cpath fill-rule='evenodd' d='M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.25 4.25a.75.75 0 01-1.06 0L5.21 8.27a.75.75 0 01.02-1.06z' clip-rule='evenodd'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem !important;
        }
        
    </style>
</head>
<body class="bg-gray-50 font-sans p-4 md:p-10">

    <div class="max-w-7xl mx-auto bg-white rounded-xl shadow-2xl p-6 md:p-10">
        <h1 class="text-2xl font-bold text-gray-900 mb-6 text-center">
            Helios Platform Architecture Map (Interactive)
        </h1>
        <p class="text-center text-gray-600 mb-4"> 
            Choose a client product at the bottom to focus on the services they utilize.
        </p>

        <div id="diagram-container" class="diagram-container bg-white">

            <!-- HELIOS ARCHITECTURE CONTAINER (Outer boundary) -->
            <div id="helios-container" 
                class="bg-blue-400/10 p-4 pt-8 rounded-3xl border-2 border-blue-900 shadow-xl mx-auto relative z-10 max-w-5xl">

                <!-- 1. HELIOS (Main Title) -->
                <img id="helios" class="boundary-title" src="assets/img/helios-golden.svg">

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 relative z-10 mt-6">
                    <!-- CONTROL PLANE -->
                    <div id="control-plane-container" 
                        class="bg-white md:col-span-2 rounded-2xl shadow-inner border-2 border-dashed border-purple-400 relative z-10 mb-4">
                        
                        <h3 id="control-plane-title" class="boundary-title">
                            Control Plane
                        </h3>
                        
                        <div id="control-plane-blocks" class="grid max-sm:grid-cols-1 max-md:grid-cols-2 max-lg:grid-cols-3 grid-cols-5 gap-2 relative z-10">
                            <!-- Service blocks generated by JS -->
                        </div>
                    </div> 
                    
                    <!-- CORE SERVICES -->
                    <div id="core-services-container" class="bg-white rounded-2xl shadow-inner border-2 border-dashed border-green-400 relative">
                        
                        <h3 id="core-services-title" class="boundary-title">
                            Core Services
                        </h3>

                        <div id="core-services-blocks" class="grid max-sm:grid-cols-1 grid-cols-2 gap-2">
                            <!-- Service blocks generated by JS -->
                        </div>
                    </div>

                    <!-- BUSINESS SOLUTIONS -->
                    <div id="business-solutions-container" class="bg-white rounded-2xl shadow-inner border-2 border-dashed border-yellow-400 relative max-md:mt-4"> 
                        
                        <h3 id="business-solutions-title" class="boundary-title">
                            Business Solutions
                        </h3>

                        <div id="business-solutions-blocks" class="grid max-sm:grid-cols-1 grid-cols-2 gap-2">
                            <!-- Service blocks generated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile View: Dropdown (Hidden on Desktop) -->
            <div id="client-products-container-mobile" 
                class="flex justify-center mt-10 z-10 md:hidden"> 
                <!-- Dropdown generated by JS -->
            </div>

            <!-- Client Products (Buttons - Hidden on Mobile) -->
            <div id="client-products-container-desktop" 
                class="flex justify-center gap-4 mt-10 z-10 flex-wrap hidden md:flex"> 
                <!-- Buttons generated by JS -->
            </div>


        </div>
    </div>

    <script>
        // --- 1. ARCHITECTURE DATA: Defines all services available in the Helios Platform ---
        const ARCHITECTURE_DATA = {
          "controlPlane": {
            "services": {
              "billing-h": "Billing (For Helios)", 
              "ci-cd": "CI / CD",
              "analytics-h": "Analytics (For Helios)", 
              "themeBuilder": "Theme Builder",
              "system-logger": "System Logger"
            }
          },
          "coreServices": {
            "services": {
              "auth": "Auth",
              "profile": "Profile",
              "billing": "Billing",
              "payment": "Payment",
              "email-sms": "Notification", 
              "logger": "Logger",
              "storage": "Storage",
              "chatBot": "Chat Bot",
              "analytics-c": "Analytics", 
              "tenantManager": "Tenant Manager"
            }
          },
          "businessSolutions": {
            "services": {
              "ecommerce": "Ecommerce",
              "promoPlanning": "Promo Planning",
              "scheduleMgmt": "Schedule Management",
              "crm": "CRM",
              "docParser": "Document Parser",
              "salesForecast": "Sales Forecasting",
              "financialForecast": "Financial Forecasting"
            }
          }
        };

        // --- 2. CLIENT -> SERVICE MAPPING: Defines which services each client product uses ---
        const CLIENT_SERVICE_MAP = [
            // The 'gray' client (Astha IT) utilizes all services.
            { id: 'ait', title: 'Astha IT', color: 'gray', services: ['billing-h', 'ci-cd', 'analytics-h', 'themeBuilder', 'system-logger', 'auth', 'profile', 'payment', 'email-sms', 'logger', 'storage', 'tenantManager'] },
            { id: 'whiz', title: 'Whiz', color: 'navy', services: ['auth', 'profile', 'billing', 'payment', 'email-sms', 'logger', 'storage', 'analytics-c', 'chatBot', 'tenantManager', 'financialForecast'] },
            { id: 'docomate', title: 'DocoMate', color: 'teal', services: ['auth', 'profile', 'billing', 'payment', 'email-sms', 'logger', 'storage', 'analytics-c', 'chatBot', 'tenantManager', 'docParser'] },
            { id: 'caboodle', title: 'Caboodle', color: 'green', services: ['auth', 'profile', 'billing', 'payment', 'email-sms', 'logger', 'storage', 'analytics-c', 'promoPlanning', 'salesForecast'] },
            { id: 'apex', title: 'Apex', color: 'red', services: ['auth', 'profile', 'billing', 'payment', 'email-sms', 'logger', 'storage', 'analytics-c', 'ecommerce'] }
        ];

        // --- 3. COLOR DEFINITIONS: Maps semantic color names to Tailwind CSS classes/hex colors ---
        const STATIC_COLOR_MAP = {
            'green': { border: '#4ade80', bg: '#f0fdf4', text: '#16a34a', block: 'bg-green-100/70 border-green-600 text-green-800 hover:bg-green-200/90', active: 'border-green-800 ring-4 ring-green-300 shadow-lg' },
            'red': { border: '#f87171', bg: '#fef2f2', text: '#dc2626', block: 'bg-red-100/70 border-red-600 text-red-800 hover:bg-red-200/90', active: 'border-red-800 ring-4 ring-red-300 shadow-lg' },
            'gray': { border: '#6b7280', bg: '#f3f4f6', text: '#1f2937', block: 'bg-gray-200/70 border-gray-700 text-gray-900 hover:bg-gray-300/90', active: 'border-gray-900 ring-4 ring-gray-400 shadow-lg' },
            'navy': { border: '#1d4ed8', bg: '#eff6ff', text: '#1e40af', block: 'bg-blue-100/70 border-blue-800 text-blue-900 hover:bg-blue-200/90', active: 'border-blue-900 ring-4 ring-blue-300 shadow-lg' },
            'teal': { border: '#0891b2', bg: '#ecfeff', text: '#155e75', block: 'bg-cyan-100/70 border-cyan-600 text-cyan-800 hover:bg-cyan-200/90', active: 'border-cyan-800 ring-4 ring-cyan-300 shadow-lg' },
        };


        // --- 4. DYNAMIC STYLES INJECTION: Generates client-specific color highlights (uses media query for desktop only) ---

        function injectDynamicStyles() {
            const styleTag = document.getElementById('dynamic-styles');
            let dynamicCss = styleTag.innerHTML;

            CLIENT_SERVICE_MAP.forEach(client => {
                const colors = STATIC_COLOR_MAP[client.color];
                if (colors) {
                    const highlightClass = `.highlight-${client.id}`;
                    // Injecting color rules using a media query ensures colors are only applied on desktop/tablet views (>= 768px).
                    // This allows the mobile view to simply use visibility toggles without color confusion.
                    dynamicCss += `
                        @media (min-width: 768px) {
                            ${highlightClass} { 
                                border-color: ${colors.border} !important; 
                                background-color: ${colors.bg} !important; 
                                color: ${colors.text} !important; 
                            }
                        }
                    `;
                }
            });

            styleTag.innerHTML = dynamicCss;
        }

        // --- 5. HELPER FUNCTION: Maps a Service ID back to the IDs of all clients that use it ---
        function getClientsForService(serviceId) {
            const clients = [];
            CLIENT_SERVICE_MAP.forEach(client => {
                if (client.services.includes(serviceId)) {
                    clients.push(client.id);
                }
            });
            // Returns a comma-separated string (e.g., 'ait,whiz,apex') for the data attribute
            return clients.join(',');
        }


        // --- 6. DYNAMIC HTML GENERATION: Creates the individual service blocks in the diagram ---

        function generateServiceBlocks(containerId, services, isInteractive = true) {
            const container = document.getElementById(containerId);
            let html = '';

            for (const [serviceId, serviceName] of Object.entries(services)) {
                
                let dataAttribute = '';

                if (isInteractive) {
                    // Populate data attribute with client IDs for filtering/highlighting
                    const clients = getClientsForService(serviceId);
                    dataAttribute = `data-clients="${clients}"`;
                }

                html += `
                    <div id="${serviceId}" ${dataAttribute} class="block bg-white text-gray-700 border border-gray-300 rounded-lg text-sm">
                        ${serviceName}
                    </div>
                `;
            }

            container.innerHTML = html;
        }
        
        // --- 6B. DYNAMIC CLIENT PRODUCT RENDERING: Creates the buttons (Desktop) and dropdown (Mobile) ---
        function renderClientProducts() {
            const containerDesktop = document.getElementById('client-products-container-desktop');
            const containerMobile = document.getElementById('client-products-container-mobile');

            let htmlDesktop = '';
            let htmlMobile = `
                <select id="client-product-dropdown" 
                        class="block w-full max-w-xs md:max-w-sm p-3 border border-gray-300 rounded-xl text-lg font-semibold shadow-md focus:ring-blue-500 focus:border-blue-500 transition-all duration-300 bg-white cursor-pointer">
                    <option value="" selected class="text-gray-500">Select a Client Product</option>
            `;
            
            CLIENT_SERVICE_MAP.forEach(client => {
                const colorDef = STATIC_COLOR_MAP[client.color];
                // Use the base block styling defined in STATIC_COLOR_MAP
                const tailwindClasses = colorDef ? colorDef.block : 'bg-gray-100 border-gray-600 text-gray-800';
                
                // Desktop Button HTML
                htmlDesktop += `
                    <div id="${client.id}-product" 
                          data-client-id="${client.id}" 
                          class="block product-block border-2 rounded-xl p-4 w-40 text-center font-bold text-lg cursor-pointer transition-all duration-300 ${tailwindClasses}">
                        ${client.title}
                    </div>
                `;
                
                // Mobile Dropdown Option HTML
                htmlMobile += `<option value="${client.id}">
                                   ${client.title}
                                   </option>`;
            });

            htmlMobile += `</select>`;

            containerDesktop.innerHTML = htmlDesktop;
            containerMobile.innerHTML = htmlMobile;
        }

        // --- 7. INTERACTION LOGIC (Click/Tap, Visibility Toggle, and Highlighting) ---
        
        // Global variables for tracking state
        const containerIds = ['control-plane-container', 'core-services-container', 'business-solutions-container'];
        let activeClientId = null;
        
        
        function updateHighlights(targetClientId) {
            const serviceBlocks = document.querySelectorAll('#core-services-blocks > div, #business-solutions-blocks > div, #control-plane-blocks > div'); 
            const products = document.querySelectorAll('#client-products-container-desktop > div'); 
            const dropdown = document.getElementById('client-product-dropdown');

            // Pre-calculate all highlight and active classes for efficient toggling
            const { highlightClasses, allHighlightClasses, activeClasses } = CLIENT_SERVICE_MAP.reduce((acc, client) => {
                acc.highlightClasses[client.id] = `highlight highlight-${client.id}`;
                acc.activeClasses[client.id] = STATIC_COLOR_MAP[client.color].active;
                acc.allHighlightClasses.push(`highlight-${client.id}`);
                return acc;
            }, { highlightClasses: {}, allHighlightClasses: ['highlight'], activeClasses: {} }); 
            
            // Utility to check for mobile view (< 768px)
            const isMobileView = () => window.innerWidth < 768;

            // Helper to determine the immediate parent container ID of a service block
            function getParentContainerId(block) {
                if (block.closest('#control-plane-blocks')) return 'control-plane-container';
                if (block.closest('#core-services-blocks')) return 'core-services-container';
                if (block.closest('#business-solutions-blocks')) return 'business-solutions-container';
                return null;
            }

            const isMobile = isMobileView();

            // 1. Reset: Ensure all service blocks and parent containers are visible and un-highlighted
            serviceBlocks.forEach(block => {
                // Remove all highlight and hidden classes
                block.classList.remove(...allHighlightClasses, 'hidden'); 
            });
            containerIds.forEach(id => {
                // Show all parent containers
                document.getElementById(id).classList.remove('hidden');
            });
            
            // 2. Manage Product Visual Focus (Desktop Buttons)
            products.forEach(p => {
                // Remove all previous strong active styles from product buttons
                Object.values(activeClasses).forEach(cls => p.classList.remove(...cls.split(' ')));
            });

            
            if (targetClientId && targetClientId !== "") {
                
                const highlightClassString = highlightClasses[targetClientId];
                const activeProductClassString = activeClasses[targetClientId];
                
                // Apply active style to the clicked desktop product button
                const activeProductButton = document.querySelector(`#${targetClientId}-product`);
                if (activeProductButton) {
                    activeProductButton.classList.add(...activeProductClassString.split(' ')); 
                }
                
                // Mobile-specific tracking: which containers have at least one visible service
                const containersVisible = { 'control-plane-container': false, 'core-services-container': false, 'business-solutions-container': false };

                // Apply highlight and manage visibility
                serviceBlocks.forEach(block => {
                    const clientsAttr = block.getAttribute('data-clients');
                    const parentContainerId = getParentContainerId(block);
                    
                    // Check if the service is relevant to the selected client
                    const isRelevant = clientsAttr && clientsAttr.split(',').map(c => c.trim()).filter(c => c).includes(targetClientId);
                    
                    
                    if (isRelevant) {
                        // Apply color highlighting ONLY on desktop view
                        if (!isMobile) {
                            block.classList.add(...highlightClassString.split(' '));
                        }
                        
                        // Mark the container as visible if we are in mobile mode and the block is relevant
                        if (isMobile && parentContainerId) {
                            containersVisible[parentContainerId] = true;
                        }
                    } 
                    
                    // Service Hiding Logic:
                    let shouldBeHidden = false;
                    
                    // On mobile, hide blocks that are NOT relevant to the selected client.
                    if (isMobile && targetClientId && !isRelevant) {
                        shouldBeHidden = true;
                    } 
                    
                    block.classList.toggle('hidden', shouldBeHidden);
                });
                
                // 3. Hide parent containers ONLY IF mobile and they contain NO visible blocks
                if (isMobile) {
                    containerIds.forEach(id => {
                        const shouldBeContainerHidden = !containersVisible[id];
                        // Hide the container if none of its services are visible for the selected client
                        document.getElementById(id).classList.toggle('hidden', shouldBeContainerHidden);
                    });
                }
                
                activeClientId = targetClientId;
            } else {
                // Clearing selection
                activeClientId = null;
            }
            
            // 4. Update Dropdown Visual Style (Mobile)
            if (dropdown) {
                // Simple color/style reset/application based on selection state
                dropdown.style.backgroundColor = 'white';
                dropdown.style.color = '#374151'; 
                if (targetClientId) {
                    dropdown.classList.add('font-extrabold');
                } else {
                    dropdown.classList.remove('font-extrabold');
                }
            }
        }


        function initializeInteractions() {
            const products = document.querySelectorAll('#client-products-container-desktop > div'); 
            const dropdown = document.getElementById('client-product-dropdown');

            // --- Desktop (Button Click/Tap Logic) ---
            products.forEach(product => {
                const clientId = product.getAttribute('data-client-id');

                product.addEventListener('click', () => {
                    // If the currently active client is clicked again, reset the view
                    if (clientId === activeClientId) {
                        updateHighlights(null); 
                        if (dropdown) dropdown.value = "";
                    } 
                    // Otherwise, activate the new client
                    else {
                        updateHighlights(clientId);
                        if (dropdown) dropdown.value = clientId;
                    }
                });
            });

            // --- Mobile (Dropdown Change Logic) ---
            if (dropdown) {
                dropdown.addEventListener('change', (event) => {
                    const selectedClientId = event.target.value;
                    updateHighlights(selectedClientId);
                });
                
                // Initial call to ensure mobile view starts correctly if a default is set
                updateHighlights(dropdown.value);
            }
            
            // Re-apply logic on window resize to ensure desktop/mobile styling and visibility are correct
            window.addEventListener('resize', () => {
                // Re-evaluate based on the current active client ID to apply/remove mobile-specific hiding/desktop-specific coloring
                updateHighlights(activeClientId);
            });
        }
        
        // --- 8. INITIALIZATION SEQUENCE ---

        window.onload = function() {
            // 1. Inject client-specific CSS colors into the style tag
            injectDynamicStyles();
            
            // 2. Generate the service blocks inside their respective containers
            generateServiceBlocks('control-plane-blocks', ARCHITECTURE_DATA.controlPlane.services, true);
            generateServiceBlocks('core-services-blocks', ARCHITECTURE_DATA.coreServices.services);
            generateServiceBlocks('business-solutions-blocks', ARCHITECTURE_DATA.businessSolutions.services);

            // 3. Render Client Products (Buttons for Desktop, Dropdown for Mobile)
            renderClientProducts();
            
            // 4. Initialize click/change event listeners
            initializeInteractions();
            
            // This ensures the initial state is correct (e.g., if starting on mobile)
            updateHighlights(activeClientId);
        };

    </script>

</body>
</html>
